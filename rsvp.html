// assets/js/rsvp.js

const ENDPOINT = "https://script.google.com/macros/s/AKfycbwWsOFd3js3FoM-MXs69YDpFO3LOEMINWNDB3f6_ksRspTWwRHTq4OCBBn6JAr8-QIhcw/exec";

document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById("rsvp-form");
  const status = document.getElementById("rsvp-status");

  if (!form) return;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    status.textContent = "Envoi en cours…";
    status.classList.remove("is-error", "is-success");

    const fd = new FormData(form);

    try {
      const res = await fetch(ENDPOINT, {
        method: "POST",
        body: new URLSearchParams(fd),
      });

      const text = await res.text();
      let data;
      try {
        data = JSON.parse(text);
      } catch {
        data = null;
      }

      if (!res.ok || !data || data.ok !== true) {
        throw new Error((data && data.message) ? data.message : text);
      }

      status.textContent = "Merci, votre réponse a bien été enregistrée.";
      status.classList.add("is-success");
      form.reset();

    } catch (err) {
      status.textContent = "Erreur lors de l’envoi. Merci de réessayer.";
      status.classList.add("is-error");
      console.error(err);
    }
  });
});
